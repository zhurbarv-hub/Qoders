# Инструкция по тестированию отображения ОФД в карточке кассы

## Проблема
Наименование выбранного ОФД не отображалось в кассе в карточке клиента.

## Выполненные изменения

### 1. Код уже был исправлен ранее
- API endpoint `/users/{user_id}/full-details` уже возвращает поле `ofd_provider_id` (users.py, строка 627)
- JavaScript код уже загружает ОФД провайдеров при инициализации (client-details.js, строка 969)
- JavaScript код уже ищет провайдера по ID и отображает название (client-details.js, строки 117-120)

### 2. Добавлены логи для диагностики
- Лог количества загруженных ОФД провайдеров
- Лог данных кассы с ofd_provider_id
- Лог найденного провайдера и его названия

### 3. Обновлены тестовые данные
В базе данных обновлены 4 кассы с ОФД провайдерами для тестирования:
- Касса ID 19 (User ID 3) → ООО "Эвотор ОФД"
- Касса ID 20 (User ID 3) → ООО "ПЕТЕР-СЕРВИС Спецтехнологии"
- Касса ID 21 (User ID 4) → ООО "Калуга Астрал"
- Касса ID 22 (User ID 4) → АО "Компания "Тензор"

## Как протестировать

1. Открыть браузер и зайти на http://localhost:8001/static/login.html
2. Авторизоваться (admin / admin)
3. В Dashboard найти клиента "ИП Петрович" (User ID 3) или "ИП Сидорова А.И." (User ID 4)
4. Открыть карточку клиента
5. Проверить раздел "Кассовые аппараты"

## Ожидаемый результат
В карточках касс должны отображаться:
- Для "Касса 1" (User 3): **ООО "Эвотор ОФД"**
- Для "Касса 2" (User 3): **ООО "ПЕТЕР-СЕРВИС Спецтехнологии"**
- Для "Касса 1" (User 4): **ООО "Калуга Астрал"**
- Для "Касса 2" (User 4): **АО "Компания "Тензор"**

## Проверка в консоли браузера (F12)
Должны появиться логи:
```
=== Начало рендеринга касс ===
Всего ОФД провайдеров загружено: 10
Список ОФД провайдеров: [...]
Обработка кассы: Касса 1 OFD ID: 11 Тип: number
ОФД провайдер найден: {id: 11, provider_name: "ООО \"Эвотор ОФД\"", ...} Название: ООО "Эвотор ОФД"
```

## Если наименование ОФД всё ещё не отображается

1. Проверить в консоли браузера:
   - Загружаются ли ОФД провайдеры (должно быть 10)
   - Приходит ли `ofd_provider_id` в данных кассы
   - Находится ли провайдер по ID

2. Проверить Network tab:
   - Запрос `/api/users/{id}/full-details` должен возвращать `ofd_provider_id` в cash_registers
   - Запрос `/api/ofd-providers?active_only=true` должен возвращать 10 провайдеров

3. Проверить в базе данных:
   ```sql
   SELECT cr.id, cr.register_name, cr.ofd_provider_id, ofd.provider_name 
   FROM cash_registers cr 
   LEFT JOIN ofd_providers ofd ON cr.ofd_provider_id = ofd.id 
   WHERE cr.user_id = 3;
   ```

## Статус
✅ Код исправлен
✅ Логи добавлены
✅ Тестовые данные подготовлены
⏳ Требуется тестирование в браузере
