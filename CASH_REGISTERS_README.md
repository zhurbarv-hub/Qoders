# ะกะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั ะบะฐััะพะฒัะผะธ ะฐะฟะฟะฐัะฐัะฐะผะธ ะบะปะธะตะฝัะพะฒ

## ะะฑะทะพั ัะตะฐะปะธะทะฐัะธะธ

ะะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ัะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั ะบะฐััะพะฒัะผะธ ะฐะฟะฟะฐัะฐัะฐะผะธ (ะะะข) ะบะปะธะตะฝัะพะฒ ั ะฒะพะทะผะพะถะฝะพัััั ะพััะปะตะถะธะฒะฐะฝะธั ะดะตะดะปะฐะนะฝะพะฒ ะฟะพ ะบะฐะถะดะพะน ะบะฐััะต.

## ะัะฟะพะปะฝะตะฝะฝัะต ะทะฐะดะฐัะธ

### โ ะคะฐะทะฐ 1: Data Layer (ะกะปะพะน ะดะฐะฝะฝัั)

1. **ะะธะณัะฐัะธั ะฑะฐะทั ะดะฐะฝะฝัั** (`backend/migrations/008_add_cash_registers.sql`)
   - ะกะพะทะดะฐะฝะฐ ัะฐะฑะปะธัะฐ `cash_registers` ั ะฟะพะปัะผะธ:
     - `id`, `user_id`, `serial_number`, `fiscal_drive_number`
     - `installation_address`, `register_name`, `is_active`
     - `created_at`, `updated_at`
   - ะะฐััะธัะตะฝะฐ ัะฐะฑะปะธัะฐ `deadlines` ะฟะพะปะตะผ `cash_register_id`
   - ะกะพะทะดะฐะฝั ะธะฝะดะตะบัั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ

2. **SQLAlchemy ะผะพะดะตะปะธ**
   - `web/app/models/cash_register.py` - ะผะพะดะตะปั CashRegister
   - ะะฑะฝะพะฒะปะตะฝะฐ `web/app/models/client.py` - ะดะพะฑะฐะฒะปะตะฝะฐ ัะฒัะทั ะฒ Deadline
   - `web/app/models/cash_register_schemas.py` - Pydantic ััะตะผั

3. **ะขะตััะพะฒัะต ะดะฐะฝะฝัะต**
   - `web/add_test_cash_registers.py` - ัะบัะธะฟั ะดะพะฑะฐะฒะปะตะฝะธั ัะตััะพะฒัั ะดะฐะฝะฝัั
   - 9 ะบะฐััะพะฒัั ะฐะฟะฟะฐัะฐัะพะฒ ะดะปั 3 ะบะปะธะตะฝัะพะฒ
   - 27 ะดะตะดะปะฐะนะฝะพะฒ ะฟัะธะฒัะทะฐะฝะฝัั ะบ ะบะฐััะฐะผ

### โ ะคะฐะทะฐ 2: Backend API

4. **CRUD API ะดะปั ะบะฐััะพะฒัั ะฐะฟะฟะฐัะฐัะพะฒ** (`web/app/api/cash_registers.py`)
   - `GET /api/cash-registers` - ัะฟะธัะพะบ ั ะฟะฐะณะธะฝะฐัะธะตะน ะธ ัะธะปัััะฐะผะธ
   - `GET /api/cash-registers/{id}` - ะดะตัะฐะปะธ ะบะฐััั ั ะดะตะดะปะฐะนะฝะฐะผะธ
   - `POST /api/cash-registers` - ัะพะทะดะฐะฝะธะต ะบะฐััั
   - `PUT /api/cash-registers/{id}` - ะพะฑะฝะพะฒะปะตะฝะธะต
   - `DELETE /api/cash-registers/{id}` - ะผัะณะบะพะต ัะดะฐะปะตะฝะธะต

5. **ะญะฝะดะฟะพะธะฝั ะฟะพะปะฝะพะน ะดะตัะฐะปะธะทะฐัะธะธ ะบะปะธะตะฝัะฐ** (`web/app/api/users.py`)
   - `GET /api/users/{id}/full-details` - ะบะปะธะตะฝั ัะพ ะฒัะตะผะธ ะบะฐััะฐะผะธ ะธ ะดะตะดะปะฐะนะฝะฐะผะธ
   - ะะตะดะปะฐะนะฝั ัะฐะทะดะตะปะตะฝั ะฝะฐ ะณััะฟะฟั: ะฟะพ ะบะฐััะฐะผ ะธ ะพะฑัะธะต

6. **ะะฑะฝะพะฒะปะตะฝะธะต API ะดะตะดะปะฐะนะฝะพะฒ** (`web/app/api/deadlines.py`)
   - ะะพะฑะฐะฒะปะตะฝ ัะธะปััั `cash_register_id`
   - ะะฑะฝะพะฒะปะตะฝั ััะตะผั ะดะปั ะฟะพะดะดะตัะถะบะธ ะฟัะธะฒัะทะบะธ ะบ ะบะฐััะฐะผ

### โ ะคะฐะทะฐ 3: Frontend UI

7. **HTML ัะฐะฑะปะพะฝ ะดะตัะฐะปัะฝะพะณะพ ะฟัะตะดััะฐะฒะปะตะฝะธั** (`web/app/static/client-details.html`)
   - ะะฐะณะพะปะพะฒะพะบ ั ะธะฝัะพัะผะฐัะธะตะน ะพ ะบะปะธะตะฝัะต
   - ะกะตะบัะธั ะธะฝัะพัะผะฐัะธะธ ะพ ะบะปะธะตะฝัะต
   - ะกะตะบัะธั ัะฟะธัะบะฐ ะบะฐััะพะฒัั ะฐะฟะฟะฐัะฐัะพะฒ
   - ะกะตะบัะธั ะดะตะดะปะฐะนะฝะพะฒ ะฟะพ ะบะฐััะฐะผ
   - ะกะตะบัะธั ะพะฑัะธั ะดะตะดะปะฐะนะฝะพะฒ

8. **JavaScript ะดะปั UI** (`web/app/static/js/client-details.js`)
   - ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ัะตัะตะท API
   - ะัะพะฑัะฐะถะตะฝะธะต ะบะฐััะพะฒัั ะฐะฟะฟะฐัะฐัะพะฒ ั ะบะฐััะพัะบะฐะผะธ
   - ะัะพะฑัะฐะถะตะฝะธะต ะดะตะดะปะฐะนะฝะพะฒ ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน
   - ะะฐะทะดะตะปะตะฝะธะต ะดะตะดะปะฐะนะฝะพะฒ ะฝะฐ ะณััะฟะฟั

### โ ะคะฐะทะฐ 4: ะะฝัะตะณัะฐัะธั

9. **ะะฑะฝะพะฒะปะตะฝะธะต ัะฟะธัะบะฐ ะบะปะธะตะฝัะพะฒ** (`web/app/static/js/users.js`)
   - ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ "ะะพะปะฝัะต ะดะตัะฐะปะธ" ะดะปั ะฟะตัะตัะพะดะฐ ะฝะฐ ัััะฐะฝะธัั ะบะปะธะตะฝัะฐ
   - ะะฝัะตะณัะฐัะธั ั ะฝะพะฒะพะน ัััะฐะฝะธัะตะน ะดะตัะฐะปะธะทะฐัะธะธ

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
backend/migrations/
  โโโ 008_add_cash_registers.sql       # SQL ะผะธะณัะฐัะธั

web/app/models/
  โโโ cash_register.py                 # ะะพะดะตะปั CashRegister
  โโโ cash_register_schemas.py         # Pydantic ััะตะผั
  โโโ client_schemas.py                # ะะฑะฝะพะฒะปะตะฝะฝัะต ััะตะผั ั ะฟะพะดะดะตัะถะบะพะน ะบะฐัั

web/app/api/
  โโโ cash_registers.py                # CRUD API ะดะปั ะบะฐัั
  โโโ users.py                         # ะะฑะฝะพะฒะปะตะฝะพ: ะดะพะฑะฐะฒะปะตะฝ full-details
  โโโ deadlines.py                     # ะะฑะฝะพะฒะปะตะฝะพ: ัะธะปััั ะฟะพ cash_register_id

web/app/static/
  โโโ client-details.html              # ะกััะฐะฝะธัะฐ ะดะตัะฐะปะตะน ะบะปะธะตะฝัะฐ
  โโโ js/
      โโโ client-details.js            # ะะพะณะธะบะฐ ัััะฐะฝะธัั ะดะตัะฐะปะตะน
      โโโ users.js                     # ะะฑะฝะพะฒะปะตะฝะพ: ะบะฝะพะฟะบะฐ ะดะตัะฐะปะตะน

web/
  โโโ add_test_cash_registers.py       # ะขะตััะพะฒัะต ะดะฐะฝะฝัะต
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### 1. ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะธ

```bash
cd d:\QoProj\KKT
python apply_migration_008.py
```

### 2. ะะพะฑะฐะฒะปะตะฝะธะต ัะตััะพะฒัั ะดะฐะฝะฝัั

```bash
cd web
python add_test_cash_registers.py
```

### 3. ะะฐะฟััะบ ะฒะตะฑ-ัะตัะฒะตัะฐ

```bash
cd web
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 4. ะขะตััะธัะพะฒะฐะฝะธะต API

```bash
python test_cash_registers_api.py
```

## API Endpoints

### ะะฐััะพะฒัะต ะฐะฟะฟะฐัะฐัั

- **GET** `/api/cash-registers` - ะกะฟะธัะพะบ ะบะฐัั
  - ะะฐัะฐะผะตััั: `page`, `limit`, `user_id`, `active_only`, `search`
  
- **GET** `/api/cash-registers/{id}` - ะะตัะฐะปะธ ะบะฐััั ั ะดะตะดะปะฐะนะฝะฐะผะธ

- **POST** `/api/cash-registers` - ะกะพะทะดะฐะฝะธะต ะบะฐััั
  ```json
  {
    "user_id": 1,
    "serial_number": "1234567890",
    "fiscal_drive_number": "9876543210",
    "register_name": "ะะฐััะฐ 1",
    "installation_address": "ะณ. ะะพัะบะฒะฐ, ัะป. ะะตะฝะธะฝะฐ, ะด. 1"
  }
  ```

- **PUT** `/api/cash-registers/{id}` - ะะฑะฝะพะฒะปะตะฝะธะต ะบะฐััั

- **DELETE** `/api/cash-registers/{id}` - ะะตะฐะบัะธะฒะฐัะธั ะบะฐััั

### ะะปะธะตะฝัั

- **GET** `/api/users/{id}/full-details` - ะะพะปะฝะฐั ะดะตัะฐะปะธะทะฐัะธั ะบะปะธะตะฝัะฐ
  ```json
  {
    "id": 1,
    "name": "ะะะ ะะพะณะฐ ะธ ะะพะฟััะฐ",
    "inn": "7701234567",
    "cash_registers": [...],
    "register_deadlines": [...],
    "general_deadlines": [...]
  }
  ```

### ะะตะดะปะฐะนะฝั

- **GET** `/api/deadlines?cash_register_id={id}` - ะะตะดะปะฐะนะฝั ะฟะพ ะบะฐััะต

## UI ะะพะผะฟะพะฝะตะฝัั

### ะกััะฐะฝะธัะฐ ะดะตัะฐะปะตะน ะบะปะธะตะฝัะฐ

URL: `/static/client-details.html?id={user_id}`

**ะกะตะบัะธะธ:**
1. ะะฐะณะพะปะพะฒะพะบ ั ะพัะฝะพะฒะฝะพะน ะธะฝัะพัะผะฐัะธะตะน
2. ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ะบะปะธะตะฝัะต
3. ะกะฟะธัะพะบ ะบะฐััะพะฒัั ะฐะฟะฟะฐัะฐัะพะฒ (ะบะฐััะพัะบะธ)
4. ะะตะดะปะฐะนะฝั ะฟะพ ะบะฐััะฐะผ (ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน)
5. ะะฑัะธะต ะดะตะดะปะฐะนะฝั

**ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั ะดะตะดะปะฐะนะฝะพะฒ:**
- ๐ข ะะตะปะตะฝัะน: > 30 ะดะฝะตะน
- ๐ก ะะตะปััะน: 15-30 ะดะฝะตะน
- ๐ ะัะฐะฝะถะตะฒัะน: 8-14 ะดะฝะตะน
- ๐ด ะัะฐัะฝัะน: < 7 ะดะฝะตะน ะธะปะธ ะฟัะพััะพัะตะฝะพ

### ะะฝัะตะณัะฐัะธั ั ะฟะฐะฝะตะปัั ะบะปะธะตะฝัะพะฒ

ะ ัะฟะธัะบะต ะบะปะธะตะฝัะพะฒ ะดะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ ั ะธะบะพะฝะบะพะน `dashboard` ะดะปั ะฟะตัะตัะพะดะฐ ะฝะฐ ัััะฐะฝะธัั ะฟะพะปะฝะพะน ะดะตัะฐะปะธะทะฐัะธะธ.

## ะะฐะทะฐ ะดะฐะฝะฝัั

**ะขะฐะฑะปะธัะฐ: cash_registers**
- 9 ะทะฐะฟะธัะตะน (ัะตััะพะฒัะต ะดะฐะฝะฝัะต)
- ะกะฒัะทั ั ัะฐะฑะปะธัะตะน users ัะตัะตะท user_id
- ะฃะฝะธะบะฐะปัะฝะพะต ะพะณัะฐะฝะธัะตะฝะธะต ะฝะฐ serial_number

**ะขะฐะฑะปะธัะฐ: deadlines**
- ะะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต cash_register_id (nullable)
- 27 ะดะตะดะปะฐะนะฝะพะฒ ะฟัะธะฒัะทะฐะฝั ะบ ะบะฐััะฐะผ
- ะะฑัะธะต ะดะตะดะปะฐะนะฝั ะธะผะตัั cash_register_id = NULL

## ะกะปะตะดัััะธะต ัะฐะณะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

1. ะะพะฑะฐะฒะธัั ะผะพะดะฐะปัะฝัะต ะพะบะฝะฐ ะดะปั ัะพะทะดะฐะฝะธั/ัะตะดะฐะบัะธัะพะฒะฐะฝะธั ะบะฐัั
2. ะะพะฑะฐะฒะธัั ะผะพะดะฐะปัะฝัะต ะพะบะฝะฐ ะดะปั ัะพะทะดะฐะฝะธั ะดะตะดะปะฐะนะฝะพะฒ ั ะฟัะธะฒัะทะบะพะน ะบ ะบะฐััะต
3. ะะพะฑะฐะฒะธัั ัะธะปัััะฐัะธั ะดะตะดะปะฐะนะฝะพะฒ ะฟะพ ััะฐัััั ะฝะฐ ัััะฐะฝะธัะต ะดะตัะฐะปะตะน
4. ะะพะฑะฐะฒะธัั ัะบัะฟะพัั ะดะฐะฝะฝัั ะบะปะธะตะฝัะฐ ั ะบะฐััะฐะผะธ
5. ะะพะฑะฐะฒะธัั ะพััะตัั ะฟะพ ะบะฐััะพะฒัะผ ะฐะฟะฟะฐัะฐัะฐะผ

## ะขะตัะฝะพะปะพะณะธะธ

- **Backend**: FastAPI, SQLAlchemy, Pydantic
- **Database**: SQLite
- **Frontend**: Material Design Lite, Vanilla JavaScript
- **API**: RESTful API ั JWT ะฐะฒัะพัะธะทะฐัะธะตะน

## ะะฒัะพัะธะทะฐัะธั

ะัะต API endpoints ััะตะฑััั JWT ัะพะบะตะฝ ะฒ ะทะฐะณะพะปะพะฒะบะต:
```
Authorization: Bearer {token}
```

ะขะตััะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั:
- ะะพะณะธะฝ: `admin`
- ะะฐัะพะปั: `admin123`
