# Telegram Bot Phase - –î–∏–∑–∞–π–Ω –¥–æ–∫—É–º–µ–Ω—Ç

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∑—ã:** TG-bot phase  
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Telegram –±–æ—Ç–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞–º–∏ –ö–ö–¢ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏  
**–û—Å–Ω–æ–≤–∞:** –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ transfer-kkt-project-to-vds.md (APPENDIX: Phase 3)  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏—è —É—Å–ª—É–≥ –ö–ö–¢ (KKT Services Expiration Management System) –≤–∫–ª—é—á–∞–µ—Ç:
- Backend API –Ω–∞ FastAPI (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π
- Telegram bot –º–æ–¥—É–ª—å (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- Background scheduler –º–æ–¥—É–ª—å (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

–î–∞–Ω–Ω–∞—è —Ñ–∞–∑–∞ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è —Å—Ä–æ–∫–∞—Ö
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤
- –†–∞–∑–ª–∏—á–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö –∑–∞ 14, 7 –∏ 3 –¥–Ω—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤ (—Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—è, –≤—Å–µ)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telegram ID
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤—Å–µ, –∫–ª–∏–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ aiogram 3.3.0 –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ APScheduler –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü—É notification_logs
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- Python 3.8+
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ SQLAlchemy
- –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è SQLite (–±–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã backend

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
bot/
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ (–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ backend.config)
‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ common.py        # –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (/start, /help)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py         # –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (/check, /status)
‚îÇ   ‚îî‚îÄ‚îÄ deadlines.py     # –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ (/list, /today, /week)
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ checker.py       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ notifier.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ formatter.py     # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ middlewares/         # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ logging.py       # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
‚îî‚îÄ‚îÄ utils/               # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ helpers.py       # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã:**
1. Telegram API ‚Üí aiogram Dispatcher
2. LoggingMiddleware ‚Üí –∑–∞–ø–∏—Å—å –≤—Ö–æ–¥—è—â–µ–π –∫–æ–º–∞–Ω–¥—ã
3. AuthMiddleware ‚Üí –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (admin/client/unknown)
4. Handler ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Å —É—á—ë—Ç–æ–º —Ä–æ–ª–∏
5. Service layer ‚Üí –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î)
6. Formatter ‚Üí —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
7. Bot.send_message ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ü–æ—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. APScheduler ‚Üí –∑–∞–ø—É—Å–∫ scheduled_check() –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
2. Checker service ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤ –∏–∑ –ë–î
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ + –∞–¥–º–∏–Ω)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ notification_logs
   - Formatter ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - Notifier ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram API
   - –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ notification_logs

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| clients | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö |
| deadlines | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–æ–≤ –∏—Å—Ç–µ—á–µ–Ω–∏—è |
| deadline_types | –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥ |
| contacts | –°–ø–∏—Å–æ–∫ Telegram ID –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| notification_logs | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:**
- v_expiring_soon (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤

**–ü–∞—Ç—Ç–µ—Ä–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ –∏–∑ backend.database
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- Read-only –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- Write –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è notification_logs

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (30 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**1.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ requirements.txt**
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- aiogram –≤–µ—Ä—Å–∏–∏ 3.3.0 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Telegram Bot API)
- APScheduler –≤–µ—Ä—Å–∏–∏ 3.10.4 (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á)
- pytz –≤–µ—Ä—Å–∏–∏ 2023.3 (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏)

**1.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
–í—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É —á–µ—Ä–µ–∑ pip –≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

**1.3 –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π**
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ bot/ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: handlers, services, middlewares, utils
- –ü—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã __init__.py –≤ –∫–∞–∂–¥–æ–π –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –§–∞–π–ª—ã –º–æ–¥—É–ª–µ–π: main.py, config.py

**1.4 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ .env**
–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–æ—Ç–∞:
- TELEGRAM_BOT_TOKEN - —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
- TELEGRAM_ADMIN_ID - Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- NOTIFICATION_CHECK_TIME - –≤—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ñ–æ—Ä–º–∞—Ç HH:MM)
- NOTIFICATION_TIMEZONE - —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (Europe/Moscow)
- NOTIFICATION_RETRY_ATTEMPTS - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- NOTIFICATION_RETRY_DELAY - –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
- NOTIFICATION_DAYS - –¥–Ω–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: 14,7,3)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .env —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

---

### –≠—Ç–∞–ø 2: –ú–æ–¥—É–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞ (20 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**2.1 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ backend/config.py**
–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞—Å—Å Settings –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è Telegram –±–æ—Ç–∞:
- telegram_bot_token: str (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- telegram_admin_id: int (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π > 0)
- notification_check_time: str (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "09:00")
- notification_timezone: str (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "UTC")
- notification_retry_attempts: int (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- notification_retry_delay: int (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫—É–Ω–¥)
- notification_days: str (—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ —Å–ø–∏—Å–æ–∫)

–î–æ–±–∞–≤–∏—Ç—å property –º–µ—Ç–æ–¥:
- notification_days_list ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ "14,7,3" –≤ —Å–ø–∏—Å–æ–∫ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª [14, 7, 3]

–í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ü–∏—Ñ—Ä, —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–æ–µ—Ç–æ—á–∏–µ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è admin_id
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ HH:MM

**2.2 –°–æ–∑–¥–∞–Ω–∏–µ bot/config.py**
–°–æ–∑–¥–∞—Ç—å –æ–±—ë—Ä—Ç–∫—É –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –±–æ—Ç–∞:

–§—É–Ω–∫—Ü–∏—è get_bot_config():
- –ò–º–ø–æ—Ä—Ç settings –∏–∑ backend.config
- –í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞ —Å bot-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

–§—É–Ω–∫—Ü–∏—è validate_bot_token(token: str) ‚Üí bool:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ Telegram
- –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- Settings –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- notification_days –ø–∞—Ä—Å–∏—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ [14, 7, 3]
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ get_bot_config()

---

### –≠—Ç–∞–ø 3: –°–µ—Ä–≤–∏—Å—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (45 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**3.1 –°–æ–∑–¥–∞–Ω–∏–µ bot/services/checker.py**

–§—É–Ω–∫—Ü–∏—è get_expiring_deadlines(db_session, days: int) ‚Üí List[Dict]:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤, –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
- –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:
  - SELECT –∏–∑ —Ç–∞–±–ª–∏—Ü: deadlines, clients, deadline_types
  - JOIN –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  - WHERE —É—Å–ª–æ–≤–∏—è:
    - deadline.status = 'active'
    - deadline.expiration_date = CURRENT_DATE + days –¥–Ω–µ–π
    - client.is_active = True
  - ORDER BY expiration_date ASC
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞:
  - deadline_id
  - client_id
  - client_name
  - client_inn
  - deadline_type_name
  - expiration_date
  - days_remaining (–≤—ã—á–∏—Å–ª—è–µ–º–æ–µ)
  - status_color (green/yellow/red –Ω–∞ –æ—Å–Ω–æ–≤–µ days_remaining)

–§—É–Ω–∫—Ü–∏—è get_notification_recipients(db_session, deadline_id: int) ‚Üí List[Dict]:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–µ
- –õ–æ–≥–∏–∫–∞:
  - –ü–æ–ª—É—á–∏—Ç—å client_id –∏–∑ deadline
  - SELECT –∏–∑ contacts WHERE client_id = X AND notifications_enabled = True
  - –î–æ–±–∞–≤–∏—Ç—å admin_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:
  - telegram_id
  - recipient_type ('admin' –∏–ª–∏ 'client')
  - contact_id (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, NULL –¥–ª—è –∞–¥–º–∏–Ω–∞)

–§—É–Ω–∫—Ü–∏—è check_notification_sent(db_session, deadline_id: int, recipient_telegram_id: str, days: int) ‚Üí bool:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:
  - SELECT COUNT(*) FROM notification_logs
  - WHERE deadline_id = X
  - AND recipient_telegram_id = Y
  - AND sent_at >= CURRENT_DATE (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è)
  - AND message_text LIKE '%{days} –¥–Ω%' (—Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π)
- –í–æ–∑–≤—Ä–∞—Ç: True –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞, False –∏–Ω–∞—á–µ

**3.2 –°–æ–∑–¥–∞–Ω–∏–µ bot/services/notifier.py**

–§—É–Ω–∫—Ü–∏—è send_notification(bot, chat_id: int, message: str, retry_count: int = 0) ‚Üí bool:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏–∫–∞:
  - –í—ã–∑–æ–≤ bot.send_message(chat_id, message, parse_mode='HTML')
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
    - TelegramAPIError (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞)
    - NetworkError (–ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é)
    - RetryAfter (rate limiting)
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏ retry_count < max_attempts:
    - –ñ–¥–∞—Ç—å retry_delay * (retry_count + 1) —Å–µ–∫—É–Ω–¥ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)
    - –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
- –í–æ–∑–≤—Ä–∞—Ç: True –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, False –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –Ω–µ—É–¥–∞—á–µ

–§—É–Ω–∫—Ü–∏—è log_notification(db_session, deadline_id: int, recipient_telegram_id: str, message: str, status: str, error_message: str = None):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ–± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏
- –ü–æ–ª—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ notification_logs:
  - deadline_id
  - recipient_telegram_id
  - message_text
  - status ('sent' –∏–ª–∏ 'failed')
  - error_message (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - sent_at (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ server_default)
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: commit –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏

–§—É–Ω–∫—Ü–∏—è process_deadline_notifications(bot, db_session, days: int) ‚Üí Dict:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ N –¥–Ω–µ–π
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤ —á–µ—Ä–µ–∑ get_expiring_deadlines(days)
  2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞:
     - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ get_notification_recipients()
     - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
       - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç —á–µ—Ä–µ–∑ check_notification_sent()
       - –ï—Å–ª–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å:
         - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ formatter
         - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ send_notification()
         - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ log_notification()
  3. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: sent_count, failed_count, skipped_count
- –í–æ–∑–≤—Ä–∞—Ç: —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**3.3 –°–æ–∑–¥–∞–Ω–∏–µ bot/services/formatter.py**

–§—É–Ω–∫—Ü–∏—è format_deadline_notification(deadline: Dict, days: int) ‚Üí str:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–µ–º—Å—è –¥–µ–¥–ª–∞–π–Ω–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:
  - Emoji –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ä–æ—á–Ω–æ—Å—Ç–∏:
    - üî¥ –µ—Å–ª–∏ days <= 3
    - üü° –µ—Å–ª–∏ days <= 7
    - üü¢ –µ—Å–ª–∏ days <= 14
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–µ–º—Å—è —Å—Ä–æ–∫–µ"
  - –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ:
    - üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: {client_name}
    - üî¢ –ò–ù–ù: {client_inn}
  - –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–µ–¥–ª–∞–π–Ω–µ:
    - üìã –£—Å–ª—É–≥–∞: {deadline_type_name}
    - üìÖ –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è: {expiration_date} (—á–µ—Ä–µ–∑ {days} –¥–Ω.)
  - –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–µ—Å–ª–∏ days <= 3): "‚ö° –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ!"
- –§–æ—Ä–º–∞—Ç: HTML (–¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ emoji)
- –í–æ–∑–≤—Ä–∞—Ç: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

–§—É–Ω–∫—Ü–∏—è format_deadline_list(deadlines: List[Dict]) ‚Üí str:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /list
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "üìã –°–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤"
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞:
    - {emoji} <b>{client_name}</b> ({client_inn})
    - {deadline_type_name} - {expiration_date} (—á–µ—Ä–µ–∑ {days} –¥–Ω.)
    - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  - –ò—Ç–æ–≥–æ: "–í—Å–µ–≥–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤: {count}"
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞: "‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤ –Ω–µ—Ç"
- –í–æ–∑–≤—Ä–∞—Ç: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

–§—É–Ω–∫—Ü–∏—è format_statistics(stats: Dict) ‚Üí str:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ dashboard
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã"
  - –û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
    - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: {active_clients_count}
    - –í—Å–µ–≥–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤: {total_deadlines_count}
  - –î–µ–¥–ª–∞–π–Ω—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:
    - üü¢ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ (>14 –¥–Ω–µ–π): {green_count}
    - üü° –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è (7-14 –¥–Ω–µ–π): {yellow_count}
    - üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (<7 –¥–Ω–µ–π): {red_count}
    - ‚ö´ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ: {expired_count}
  - –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã (—Ç–æ–ø 5)
- –í–æ–∑–≤—Ä–∞—Ç: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –≤–∫–ª—é—á–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
- –î—É–±–ª–∏–∫–∞—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç—Å—è
- –°–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

---

### –≠—Ç–∞–ø 4: Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (20 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**4.1 –°–æ–∑–¥–∞–Ω–∏–µ bot/middlewares/auth.py**

–ö–ª–∞—Å—Å AuthMiddleware (BaseMiddleware):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

–ú–µ—Ç–æ–¥ __call__(self, handler, event, data):
- –ò–∑–≤–ª–µ—á—å user.id –∏–∑ event
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª—å:
  - –í—ã–∑–≤–∞—Ç—å is_admin(user_id) ‚Üí role = 'admin'
  - –ò–Ω–∞—á–µ –≤—ã–∑–≤–∞—Ç—å get_client_by_telegram_id(user_id) ‚Üí role = 'client', —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å client_id
  - –ò–Ω–∞—á–µ ‚Üí role = 'unknown'
- –î–æ–±–∞–≤–∏—Ç—å –≤ data:
  - user_role
  - client_id (–µ—Å–ª–∏ role = 'client')
  - is_admin (boolean)
- –ü–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ handler

–§—É–Ω–∫—Ü–∏—è is_admin(user_id: int) ‚Üí bool:
- –ü–æ–ª—É—á–∏—Ç—å telegram_admin_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –°—Ä–∞–≤–Ω–∏—Ç—å user_id == admin_id
- –í–æ–∑–≤—Ä–∞—Ç: —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

–§—É–Ω–∫—Ü–∏—è get_client_by_telegram_id(db_session, telegram_id: str) ‚Üí Optional[Dict]:
- –ó–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ contacts:
  - SELECT contact.*, client.* FROM contacts
  - JOIN clients ON contacts.client_id = clients.id
  - WHERE telegram_id = {telegram_id}
  - AND notifications_enabled = True
  - AND client.is_active = True
- –í–æ–∑–≤—Ä–∞—Ç: —Å–ª–æ–≤–∞—Ä—å —Å client_id, client_name –∏–ª–∏ None

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ Telegram ID
- –ö–ª–∏–µ–Ω—Ç—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É contacts
- –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Ä–æ–ª—å 'unknown'
- –î–∞–Ω–Ω—ã–µ —Ä–æ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö

---

### –≠—Ç–∞–ø 5: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥ (60 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**5.1 –°–æ–∑–¥–∞–Ω–∏–µ bot/handlers/common.py**

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –±–æ—Ç–∞
- –õ–æ–≥–∏–∫–∞:
  - –ü–æ–ª—É—á–∏—Ç—å user_role –∏–∑ middleware data
  - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
    - –ù–∞–∑–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
    - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–æ—Ç–∞
    - –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –ï—Å–ª–∏ role = 'admin':
    - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - –ï—Å–ª–∏ role = 'client':
    - –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
  - –ï—Å–ª–∏ role = 'unknown':
    - –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    - –ö–æ–Ω—Ç–∞–∫—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º
- –õ–æ–≥–∏–∫–∞:
  - –ü–æ–ª—É—á–∏—Ç—å user_role
  - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥:
    - –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –≤—Å–µ—Ö):
      - /start - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
      - /help - —Å–ø—Ä–∞–≤–∫–∞
    - –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–¥–ª—è admin –∏ client):
      - /list - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤
      - /today - –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
      - /week - –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –Ω–µ–¥–µ–ª—é
    - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–ª—å–∫–æ admin):
      - /status - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
      - /check - —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
  - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**5.2 –°–æ–∑–¥–∞–Ω–∏–µ bot/handlers/admin.py**

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /check:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤
- –õ–æ–≥–∏–∫–∞:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å is_admin –∏–∑ middleware
  - –ï—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ, –≤—ã—Ö–æ–¥
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤..."
  - –ü–æ–ª—É—á–∏—Ç—å notification_days_list –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è days:
    - –í—ã–∑–≤–∞—Ç—å process_deadline_notifications(bot, db_session, days)
    - –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
    - –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤
    - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - –ü—Ä–æ–ø—É—â–µ–Ω–æ (–¥—É–±–ª–∏–∫–∞—Ç—ã)
    - –û—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –¥–µ—Ç–∞–ª—è–º–∏

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /status:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- –õ–æ–≥–∏–∫–∞:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å is_admin
  - –ï—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω: –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ
  - –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    - –ë–ª–∏–∂–∞–π—à–∏–µ 5 –¥–µ–¥–ª–∞–π–Ω–æ–≤
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ formatter.format_statistics()
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î

**5.3 –°–æ–∑–¥–∞–Ω–∏–µ bot/handlers/deadlines.py**

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /list:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤
- –õ–æ–≥–∏–∫–∞:
  - –ü–æ–ª—É—á–∏—Ç—å user_role –∏ client_id –∏–∑ middleware
  - –ï—Å–ª–∏ role = 'unknown': –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ
  - –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –ë–î:
    - SELECT –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π
    - –ï—Å–ª–∏ role = 'client': WHERE client_id = {client_id}
    - ORDER BY expiration_date ASC
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ formatter.format_deadline_list()
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏—è:
    - –ï—Å–ª–∏ > 4000 —Å–∏–º–≤–æ–ª–æ–≤: —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /today:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¥–µ–¥–ª–∞–π–Ω—ã, –∏—Å—Ç–µ–∫–∞—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è
- –õ–æ–≥–∏–∫–∞:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ /list)
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: WHERE expiration_date = CURRENT_DATE
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ client_id –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç: "‚úÖ –°–µ–≥–æ–¥–Ω—è –¥–µ–¥–ª–∞–π–Ω–æ–≤ –Ω–µ—Ç"

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /week:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é
- –õ–æ–≥–∏–∫–∞:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: WHERE expiration_date BETWEEN CURRENT_DATE AND CURRENT_DATE + 7
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ client_id
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–µ-–∞–¥–º–∏–Ω–∞–º
- –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ø–æ–Ω—è—Ç–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –î–ª–∏–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è

---

### –≠—Ç–∞–ø 6: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (30 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**6.1 –°–æ–∑–¥–∞–Ω–∏–µ bot/main.py**

–§—É–Ω–∫—Ü–∏—è create_bot() ‚Üí Bot:
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ get_bot_config()
- –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Bot —Å telegram_bot_token
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å parse_mode –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (HTML)
- –í–æ–∑–≤—Ä–∞—Ç: —ç–∫–∑–µ–º–ø–ª—è—Ä Bot

–§—É–Ω–∫—Ü–∏—è create_dispatcher() ‚Üí Dispatcher:
- –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Dispatcher
- –í–æ–∑–≤—Ä–∞—Ç: —ç–∫–∑–µ–º–ø–ª—è—Ä Dispatcher

–§—É–Ω–∫—Ü–∏—è setup_middlewares(dp: Dispatcher, db_session):
- –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä AuthMiddleware(db_session)
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ dp.message.middleware(auth_middleware)
- –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä LoggingMiddleware()
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ dp.message.middleware(logging_middleware)

–§—É–Ω–∫—Ü–∏—è register_handlers(dp: Dispatcher):
- –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–∑ handlers/
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
  1. –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å —Ñ–∏–ª—å—Ç—Ä–æ–º is_admin)
     - /check ‚Üí admin.check_handler
     - /status ‚Üí admin.status_handler
  2. –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤
     - /list ‚Üí deadlines.list_handler
     - /today ‚Üí deadlines.today_handler
     - /week ‚Üí deadlines.week_handler
  3. –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º)
     - /start ‚Üí common.start_handler
     - /help ‚Üí common.help_handler
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥ (Command filter)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è main():
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç, —É—Ä–æ–≤–µ–Ω—å, —Ñ–∞–π–ª)
  2. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ create_bot()
  3. –°–æ–∑–¥–∞—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä —á–µ—Ä–µ–∑ create_dispatcher()
  4. –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é –ë–î –∏–∑ backend.database
  5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å middleware —á–µ—Ä–µ–∑ setup_middlewares()
  6. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ register_handlers()
  7. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
  8. –ó–∞–ø—É—Å—Ç–∏—Ç—å polling: await dp.start_polling(bot)
  9. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (Ctrl+C):
     - –ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é –ë–î
     - –ó–∞–∫—Ä—ã—Ç—å –±–æ—Ç–∞
     - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É

–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞:
```
if __name__ == '__main__':
    asyncio.run(main())
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- Graceful shutdown –ø—Ä–∏ Ctrl+C
- –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –≠—Ç–∞–ø 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (30 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**7.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ bot/main.py**

–§—É–Ω–∫—Ü–∏—è setup_scheduler(bot, db_session) ‚Üí AsyncIOScheduler:
- –ò–º–ø–æ—Ä—Ç AsyncIOScheduler –∏–∑ apscheduler.schedulers.asyncio
- –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
  - notification_check_time (–Ω–∞–ø—Ä–∏–º–µ—Ä, "09:00")
  - notification_timezone (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Europe/Moscow")
- –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å –≤—Ä–µ–º—è: hour, minute = notification_check_time.split(":")
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ add_job():
  - func=scheduled_check
  - trigger='cron'
  - hour=hour
  - minute=minute
  - timezone=notification_timezone
  - args=[bot, db_session]
  - id='daily_deadline_check'
  - replace_existing=True
- –í–æ–∑–≤—Ä–∞—Ç: —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è scheduled_check(bot, db_session):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—Ä–µ–º—è, —Ç–∞–π–º–∑–æ–Ω–∞)
  2. –ü–æ–ª—É—á–∏—Ç—å notification_days_list –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, [14, 7, 3])
  3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è days:
     - –í—ã–∑–≤–∞—Ç—å process_deadline_notifications(bot, db_session, days)
     - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
     - –°–æ–±—Ä–∞—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç:
     - –í—Å–µ–≥–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
     - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
     - –û—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
  5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
  6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
     - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π traceback
     - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
     - –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ main():
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
- –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫: scheduler = setup_scheduler(bot, db_session)
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫: scheduler.start()
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å: "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ {time}"
- –ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
  - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫: scheduler.shutdown()
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ /check –∫–æ–º–∞–Ω–¥—É
- Scheduled job –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—Ç–µ—Å—Ç —Å –±–ª–∏–∂–∞–π—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º)
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

---

### –≠—Ç–∞–ø 8: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (20 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**8.1 –°–æ–∑–¥–∞–Ω–∏–µ bot/middlewares/logging.py**

–ö–ª–∞—Å—Å LoggingMiddleware(BaseMiddleware):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–±—ã—Ç–∏–π

–ú–µ—Ç–æ–¥ __call__(self, handler, event, data):
- –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
  - user_id
  - username
  - first_name
  - last_name
- –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã
- –ó–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥:
  - Timestamp
  - User info (id, username, name)
  - Command text
  - Chat ID
- –ó–∞—Å–µ—á—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ handler
- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
  - –í—ã—á–∏—Å–ª–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–µ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
  - –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –ª—é–±–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π traceback
  - –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞–ª—å—à–µ –¥–ª—è error handler

**8.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ bot/main.py**

–í —Ñ—É–Ω–∫—Ü–∏–∏ main() –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –±–æ—Ç–∞:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å logging.basicConfig():
  - –§–æ—Ä–º–∞—Ç: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  - –£—Ä–æ–≤–µ–Ω—å: –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (log_level)
  - Handlers:
    - RotatingFileHandler:
      - –§–∞–π–ª: logs/bot.log
      - maxBytes: 10 * 1024 * 1024 (10 MB)
      - backupCount: 5
      - encoding: utf-8
    - StreamHandler (–≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å)
- –°–æ–∑–¥–∞—Ç—å logger –¥–ª—è –º–æ–¥—É–ª—è bot: logger = logging.getLogger('bot')

**8.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫**

–§—É–Ω–∫—Ü–∏—è error_handler(update, exception):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–æ—Ç–∞
- –¢–∏–ø—ã –æ—à–∏–±–æ–∫:
  - TelegramBadRequest: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ
  - TelegramRetryAfter: rate limiting
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
    - –°–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É
    - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
  - NetworkError: –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
    - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏
  - –ü—Ä–æ—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É —Å traceback
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
    - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è error handler –≤ main():
- dp.errors.register(error_handler)

–§—É–Ω–∫—Ü–∏—è notify_admin_on_error(bot, error_message: str):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –õ–æ–≥–∏–∫–∞:
  - –ü–æ–ª—É—á–∏—Ç—å admin_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
    - üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ë–û–¢–ê
    - –í—Ä–µ–º—è –æ—à–∏–±–∫–∏
    - –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ bot.send_message()
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω—É —Ç–æ–∂–µ –ø–∞–¥–∞–µ—Ç

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º traceback
- –§–∞–π–ª—ã –ª–æ–≥–æ–≤ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- –ë–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫

---

### –≠—Ç–∞–ø 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (60 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**9.1 –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã**

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª tests/test_bot_services.py:

–¢–µ—Å—Ç—ã –¥–ª—è checker.py:
- test_get_expiring_deadlines_returns_list()
  - –ú–æ–∫ –ë–î —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
  - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å days=7
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- test_get_expiring_deadlines_filters_by_days()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º
- test_get_notification_recipients_includes_admin()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∞–¥–º–∏–Ω –≤—Å–µ–≥–¥–∞ –≤ —Å–ø–∏—Å–∫–µ
- test_get_notification_recipients_filters_enabled()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ notifications_enabled
- test_check_notification_sent_detects_duplicates()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–¢–µ—Å—Ç—ã –¥–ª—è formatter.py:
- test_format_deadline_notification_structure()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- test_format_deadline_notification_emoji_by_days()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ emoji –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π days
- test_format_deadline_list_empty()
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞
- test_format_deadline_list_multiple()
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤
- test_format_statistics()
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–¢–µ—Å—Ç—ã –¥–ª—è notifier.py:
- test_send_notification_success() (–º–æ–∫ bot.send_message)
  - –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True
- test_send_notification_retry_on_network_error()
  - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ NetworkError
- test_log_notification_creates_record()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î

**9.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª tests/test_bot_integration.py:

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –≤ –ø–∞–º—è—Ç–∏ (SQLite :memory:)
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (clients, deadlines, contacts)
- –ú–æ–∫ Telegram Bot API

–¢–µ—Å—Ç—ã:
- test_notification_flow_end_to_end()
  - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥–µ–¥–ª–∞–π–Ω –∏—Å—Ç–µ–∫–∞—é—â–∏–π —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
  - –í—ã–∑–≤–∞—Ç—å process_deadline_notifications()
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤ bot.send_message —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ notification_logs
- test_command_authentication()
  - –¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –∞–¥–º–∏–Ω–∞ - –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
  - –¢–µ—Å—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ - –æ—Ç–∫–∞–∑
  - –¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –æ—Ç–∫–∞–∑
- test_auth_middleware_determines_roles()
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏ 'admin'
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏ 'client'
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ 'unknown'

**9.3 –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

–¢–µ—Å—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è Telegram –±–æ—Ç–∞:

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥ (–∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä):
- [ ] /start ‚Üí –ø–æ–ª—É—á–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∫–æ–º–∞–Ω–¥
- [ ] /help ‚Üí –ø–æ–ª—É—á–µ–Ω–∞ —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
- [ ] /status ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å–≤–µ—Ä–∏—Ç—å —Å –ë–î)
- [ ] /list ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤—Å–µ –¥–µ–¥–ª–∞–π–Ω—ã
- [ ] /today ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–∏–ª–∏ "–Ω–µ—Ç –¥–µ–¥–ª–∞–π–Ω–æ–≤")
- [ ] /week ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –¥–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –Ω–µ–¥–µ–ª—é
- [ ] /check ‚Üí –∑–∞–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–ª—É—á–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥ (–∫–∞–∫ –∫–ª–∏–µ–Ω—Ç):
- [ ] /start ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- [ ] /list ‚Üí —Ç–æ–ª—å–∫–æ –¥–µ–¥–ª–∞–π–Ω—ã —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- [ ] /status ‚Üí –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ
- [ ] /check ‚Üí –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥–µ–¥–ª–∞–π–Ω –∏—Å—Ç–µ–∫–∞—é—â–∏–π —á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å /check
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ notification_logs (status='sent')
- [ ] –ü–æ–≤—Ç–æ—Ä–∏—Ç—å /check ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (–¥—É–±–ª–∏–∫–∞—Ç)
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã –¥–ª—è 7 –∏ 3 –¥–Ω–µ–π, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- [ ] –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å telegram_id
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –¥–µ–¥–ª–∞–π–Ω—ã —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É ‚Üí –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ë–î ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –í—Å–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (>90% –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- –í—Å–µ –ø—É–Ω–∫—Ç—ã —Ä—É—á–Ω–æ–≥–æ —á–µ–∫-–ª–∏—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- –ù–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞ (–æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É < 1 —Å–µ–∫)

---

### –≠—Ç–∞–ø 10: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é (30 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∏:**

**10.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README.md –ø—Ä–æ–µ–∫—Ç–∞**

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª: "Telegram Bot"

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–æ—Ç–∞:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–∞—Ö
  - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤
  - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:
  1. –ù–∞–π—Ç–∏ @BotFather –≤ Telegram
  2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /newbot
  3. –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
  4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
  5. –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π Telegram ID (—á–µ—Ä–µ–∑ @userinfobot)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .env:
  - –°–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  - –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π
  - –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:
  - –ö–æ–º–∞–Ω–¥–∞: python -m bot.main
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
  - –û—Å—Ç–∞–Ω–æ–≤–∫–∞: Ctrl+C
- –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
  - –¢–∞–±–ª–∏—Ü–∞ –∫–æ–º–∞–Ω–¥ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º (–∞–¥–º–∏–Ω/–∫–ª–∏–µ–Ω—Ç)
- Troubleshooting:
  - –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
  - –ö–æ–º–∞–Ω–¥—ã –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**10.2 –°–æ–∑–¥–∞–Ω–∏–µ bot/README.md**

–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞:
  - –î–∏–∞–≥—Ä–∞–º–º–∞ –º–æ–¥—É–ª–µ–π (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
  - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:
  - –î–µ—Ä–µ–≤–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- –ú–æ–¥—É–ª–∏ –∏ –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:
  - handlers/ - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - services/ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î
  - middlewares/ - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - utils/ - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
  - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ vs –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- –ü—Ä–æ—Ü–µ—Å—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  - –ë–ª–æ–∫-—Å—Ö–µ–º–∞ (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)
  - –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ:
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Windows
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Linux/VDS
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞ (–¥–ª—è VDS)

**10.3 –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è requirements.txt**

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å —Ç–æ—á–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏:
```
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
pydantic==2.5.0
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
aiogram==3.3.0
APScheduler==3.10.4
pytz==2023.3
```

–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –≥—Ä—É–ø–ø –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
- Backend API
- Authentication
- Database
- Telegram Bot
- Scheduler

**10.4 –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–ø—É—Å–∫–∞**

–°–æ–∑–¥–∞—Ç—å start_bot.bat (–¥–ª—è Windows):
```
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
- @echo off
- echo –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ –ö–ö–¢...
- REM –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- call venv\Scripts\activate.bat
- REM –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è .env
- if not exist .env (
    echo –û–®–ò–ë–ö–ê: –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω
    pause
    exit /b 1
  )
- REM –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
- python -m bot.main
- REM –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- if errorlevel 1 (
    echo –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
    pause
  )
```

–°–æ–∑–¥–∞—Ç—å start_bot.sh (–¥–ª—è Linux):
```
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
- #!/bin/bash
- echo "–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ –ö–ö–¢..."
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è venv: source venv/bin/activate
- –ü—Ä–æ–≤–µ—Ä–∫–∞ .env
- –ó–∞–ø—É—Å–∫: python -m bot.main
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–æ–≤ –≤—ã—Ö–æ–¥–∞
```

–°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: chmod +x start_bot.sh

**10.5 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ VDS**

–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç: docs/bot_deployment.md

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:
  - Ubuntu/Debian Linux
  - Python 3.8+
  - –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ VDS:
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .env –¥–ª—è production
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞:
  - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ kkt-bot.service
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
  - –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (start, stop, restart, status)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–≥–∏
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ journalctl
  - –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞ –Ω–∞—á–∏–Ω–∞—é—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- requirements.txt —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –≤–µ—Ä—Å–∏—è–º–∏
- –°–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Windows –∏ Linux
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã (–º–∏–Ω–∏–º—É–º –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)
- –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –Ω–∞ production

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### –î–µ–Ω—å 1 (4 —á–∞—Å–∞)
**–≠—Ç–∞–ø—ã 1-3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Å–µ—Ä–≤–∏—Å—ã –ë–î**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ checker, notifier, formatter
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —è–¥—Ä–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≥–æ—Ç–æ–≤–æ, –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î

### –î–µ–Ω—å 2 (4 —á–∞—Å–∞)
**–≠—Ç–∞–ø—ã 4-6: Middleware, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ middleware
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã

### –î–µ–Ω—å 3 (3 —á–∞—Å–∞)
**–≠—Ç–∞–ø—ã 7-8: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è APScheduler
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è middleware –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç, –≤—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

### –î–µ–Ω—å 4 (3 —á–∞—Å–∞)
**–≠—Ç–∞–ø 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ü–æ–ª–Ω–æ–µ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

### –î–µ–Ω—å 5 (2 —á–∞—Å–∞)
**–≠—Ç–∞–ø 10: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- –†–µ–∑—É–ª—å—Ç–∞—Ç: production-ready –±–æ—Ç —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

**–ò—Ç–æ–≥–æ: 16 —á–∞—Å–æ–≤ –Ω–∞ 5 –¥–Ω–µ–π**

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|-----|----------|--------|
| TELEGRAM_BOT_TOKEN | string | –¢–æ–∫–µ–Ω –æ—Ç @BotFather | 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz |
| TELEGRAM_ADMIN_ID | integer | Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | 123456789 |
| NOTIFICATION_CHECK_TIME | string | –í—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (HH:MM) | 09:00 |
| NOTIFICATION_TIMEZONE | string | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å | Europe/Moscow |
| NOTIFICATION_RETRY_ATTEMPTS | integer | –ü–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ | 3 |
| NOTIFICATION_RETRY_DELAY | integer | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—Å–µ–∫) | 300 |
| NOTIFICATION_DAYS | string | –î–Ω–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | 14,7,3 |

–¢–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ backend:
- DATABASE_PATH - –ø—É—Ç—å –∫ –ë–î SQLite
- JWT_SECRET_KEY - –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API
- LOG_LEVEL - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ .env —Ñ–∞–π–ª–∞

```
Database
DATABASE_PATH=database/kkt_services.db

API Server
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=false

Security
JWT_SECRET_KEY=your-secret-key-here-minimum-32-characters
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

Telegram Bot
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_ADMIN_ID=123456789
NOTIFICATION_CHECK_TIME=09:00
NOTIFICATION_TIMEZONE=Europe/Moscow
NOTIFICATION_RETRY_ATTEMPTS=3
NOTIFICATION_RETRY_DELAY=300
NOTIFICATION_DAYS=14,7,3

Logging
LOG_LEVEL=INFO
LOG_FILE=logs/application.log

CORS
CORS_ORIGINS=http://localhost:8000
```

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (–≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|---------|----------|--------|
| /start | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã | –í—Å–µ |
| /help | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º | –í—Å–µ |

### –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –∫–ª–∏–µ–Ω—Ç—ã)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|---------|----------|--------|
| /list | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤ (30 –¥–Ω–µ–π) | Admin, Client |
| /today | –î–µ–¥–ª–∞–π–Ω—ã –∏—Å—Ç–µ–∫–∞—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è | Admin, Client |
| /week | –î–µ–¥–ª–∞–π–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é | Admin, Client |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|---------|----------|--------|
| /status | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º) | Admin only |
| /check | –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | Admin only |

---

## –õ–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ APScheduler –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (NOTIFICATION_CHECK_TIME)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–Ω–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ [14, 7, 3])
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è days:
   - –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã, –∏—Å—Ç–µ–∫–∞—é—â–∏–µ —á–µ—Ä–µ–∑ days –¥–Ω–µ–π
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞:
     - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ + –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
     - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
       - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –±—ã–ª–æ –ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è
       - –ï—Å–ª–∏ –Ω–µ—Ç:
         - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
         - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram API
         - –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ notification_logs
       - –ï—Å–ª–∏ –¥–∞: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–∏–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
3. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
- –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ notification_logs
- –ö—Ä–∏—Ç–µ—Ä–∏–∏: deadline_id + recipient_telegram_id + sent_at (—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞)
- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏:
  - –†—É—á–Ω–æ–º –≤—ã–∑–æ–≤–µ /check –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å
  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
  - –î—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á–∞—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏

**Retry –º–µ—Ö–∞–Ω–∏–∑–º:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: NOTIFICATION_RETRY_ATTEMPTS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- –ó–∞–¥–µ—Ä–∂–∫–∞: NOTIFICATION_RETRY_DELAY * (attempt_number) —Å–µ–∫—É–Ω–¥ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏:
  - NetworkError: –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
  - RetryAfter: rate limiting Telegram API
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ API

**–ù–µ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –Ω–µ—É–¥–∞—á–∞):**
- TelegramForbiddenError: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
- ChatNotFound: —á–∞—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- UserDeactivated: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: status='sent', error_message=NULL
- –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–µ—É–¥–∞—á–∞: status='failed', error_message=–¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

---

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –¢–∞–±–ª–∏—Ü–∞ notification_logs

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–∏ –æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| deadline_id | Integer | –°—Å—ã–ª–∫–∞ –Ω–∞ deadlines.id (CASCADE DELETE) |
| recipient_telegram_id | String(50) | Telegram ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| message_text | Text | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| status | String(20) | –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ ('sent' –∏–ª–∏ 'failed') |
| error_message | Text | –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ status='failed') |
| sent_at | DateTime | Timestamp –æ—Ç–ø—Ä–∞–≤–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) |

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- ix_notification_logs_deadline_sent: (deadline_id, sent_at)
- ix_notification_logs_recipient: (recipient_telegram_id)
- ix_notification_logs_status: (status)

**–ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–æ–∫

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:**
- Telegram ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å TELEGRAM_ADMIN_ID –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
- –í–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ö–ª–∏–µ–Ω—Ç:**
- Telegram ID –Ω–∞–π–¥–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ contacts
- –°–≤—è–∑–∞–Ω —Å –∞–∫—Ç–∏–≤–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º (client.is_active = True)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã (notifications_enabled = True)
- –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã
- –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
- Telegram ID –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –∞–¥–º–∏–Ω–∞—Ö, –Ω–∏ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ /start –∏ /help
- –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ù–µ –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
- –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î: –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ client_id
- –í–∏–¥–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

**–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**
- –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä WHERE client_id = {user_client_id}
- Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç client_id –≤ data
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–ù–∞ —É—Ä–æ–≤–Ω–µ middleware:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ AuthMiddleware
- –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è handler
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã

**–ù–∞ —É—Ä–æ–≤–Ω–µ handlers:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ is_admin –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –û—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å user_id
- –û—Ç–∫–∞–∑—ã –≤ –¥–æ—Å—Ç—É–ø–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –£—Ä–æ–≤–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**1. –£—Ä–æ–≤–µ–Ω—å Telegram API (notifier.py):**
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- Graceful degradation –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

**2. –£—Ä–æ–≤–µ–Ω—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (services):**
- Try-except –±–ª–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**3. –£—Ä–æ–≤–µ–Ω—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (handlers):**
- –ü–µ—Ä–µ—Ö–≤–∞—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è –±–æ—Ç–∞

**4. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (error_handler):**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ traceback

### –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ–∞–∫—Ü–∏–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ–∞–∫—Ü–∏—è |
|--------|---------|---------|
| TelegramForbiddenError | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–º–µ—Ç–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π |
| DatabaseError | –ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î | –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ |
| ConfigurationError | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø—É—Å–∫–∞, –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| NetworkError | –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é | Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π |
| ValidationError | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –ø—Ä–æ–±–ª–µ–º–µ |

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –±–æ—Ç–∞ (–Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è)
- –ü—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- –ú–∞—Å—Å–æ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (>50% –Ω–µ—É–¥–∞—á)
- –û—à–∏–±–∫–∞—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)

–§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```
üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ë–û–¢–ê

–í—Ä–µ–º—è: 2024-01-15 10:30:45
–ú–æ–¥—É–ª—å: bot.services.notifier
–û—à–∏–±–∫–∞: DatabaseConnectionError

–î–µ—Ç–∞–ª–∏:
Unable to connect to database at database/kkt_services.db
[–ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ traceback]

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:**
- logs/bot.log - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ –±–æ—Ç–∞
- –†–æ—Ç–∞—Ü–∏—è: –º–∞–∫—Å–∏–º—É–º 10 MB –Ω–∞ —Ñ–∞–π–ª, 5 —Ñ–∞–π–ª–æ–≤ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- –§–æ—Ä–º–∞—Ç: `[timestamp] [level] [module] - message`

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
- –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å user_id
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ scheduled –∑–∞–¥–∞—á
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í—Å–µ –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º traceback
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- DEBUG: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î, API calls)
- INFO: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–∫–æ–º–∞–Ω–¥—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- WARNING: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (retry –ø–æ–ø—ã—Ç–∫–∏)
- ERROR: –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è (failed notifications)
- CRITICAL: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (–ø–∞–¥–µ–Ω–∏–µ –±–æ—Ç–∞)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã

**–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
- –ö–æ–º–∞–Ω–¥–∞ /status –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ö–æ–º–∞–Ω–¥–∞ /check –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ –¥–µ–Ω—å
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫:**
- –¢–∞–±–ª–∏—Ü–∞ notification_logs (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- –õ–æ–≥–∏ –±–æ—Ç–∞ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏)
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤)

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

**–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å: ps aux | grep bot.main
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: tail -f logs/bot.log
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç—å: ping api.telegram.org

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ –ª–æ–≥–∞—Ö: "Scheduler started"
2. –í—Ä—É—á–Ω—É—é –≤—ã–∑–≤–∞—Ç—å /check
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å notification_logs –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ contacts —Å telegram_id

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å DATABASE_PATH –≤ .env
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –ë–î
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –ë–î
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: sqlite3 database/kkt_services.db ".tables"

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
pip install -r requirements.txt
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
cp .env.example .env
nano .env
–î–æ–±–∞–≤–∏—Ç—å TELEGRAM_BOT_TOKEN –∏ TELEGRAM_ADMIN_ID
```

**–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):**
```bash
python -m bot.main
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
pytest tests/test_bot_services.py -v
pytest tests/test_bot_integration.py -v
pytest tests/ -v --cov=bot --cov-report=html
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
tail -f logs/bot.log
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞:**
```
Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è production (Linux/VDS)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ systemd service:**
```bash
sudo cp deployment/kkt-bot.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable kkt-bot
sudo systemctl start kkt-bot
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º:**
```bash
sudo systemctl status kkt-bot
sudo systemctl restart kkt-bot
sudo systemctl stop kkt-bot
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
journalctl -u kkt-bot -f
journalctl -u kkt-bot --since today
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

- ‚úÖ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram API
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã (/start, /help, /list, /today, /week, /status, /check) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º –∏ –∫–æ–º–∞–Ω–¥–∞–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∑–∞ 14, 7 –∏ 3 –¥–Ω—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ –î—É–±–ª–∏–∫–∞—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç—Å—è
- ‚úÖ –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º emoji –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (retry, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞ (separation of concerns)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ SQLAlchemy
- ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ backend –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ requirements.txt
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- ‚úÖ Graceful shutdown –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ (Ctrl+C)

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

- ‚úÖ –ö–æ–¥ –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏ (>80% —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã
- ‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å user-friendly —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞ (–∫–æ–º–∞–Ω–¥—ã –æ—Ç–≤–µ—á–∞—é—Ç <1 —Å–µ–∫)
- ‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ production

---

# PHASE 5: WEB INTERFACE - TECHNICAL DESIGN

## Phase Overview

**Phase Name:** Web Interface Development (Phase 5)  
**Duration:** 2 weeks (Weeks 6-7)  
**Status:** Planning  
**Dependencies:** Phases 1-4 (Database, Backend, Telegram Bot, Scheduler)

**Objective:**  
Develop a comprehensive, responsive web interface for the KKT Service Expiration Management System, providing visual management capabilities for clients, deadlines, and users with role-based access control.

**Selected Technology Stack:**
- Frontend: HTML + CSS + Vanilla JavaScript
- Backend: FastAPI (async Python framework)
- Functionality: Extended (analytics, charts, export)
- Authentication: Role-based (admin/manager/viewer)
- Design: Modern Material Design
- Priority Features: Client management, Deadline management, User management

---

## Technology Stack Details

### Backend Components

**FastAPI Framework**
- Modern async Python web framework
- Built-in OpenAPI documentation
- Pydantic data validation
- High performance (comparable to NodeJS)

**Dependencies:**
- `fastapi` >= 0.104.0 - Web framework
- `uvicorn[standard]` >= 0.24.0 - ASGI server
- `python-jose[cryptography]` >= 3.3.0 - JWT handling
- `passlib[bcrypt]` >= 1.7.4 - Password hashing
- `python-multipart` >= 0.0.6 - Form data handling

### Frontend Components

**Core Technologies:**
- HTML5 - Semantic markup
- CSS3 - Modern styling (Grid, Flexbox)
- JavaScript ES6+ - No framework, vanilla JS

**UI Library:**
- Material Design Lite (MDL) - Google's lightweight Material Design
- Minimal overhead, no build step required
- Responsive out of the box

**Visualization Libraries:**
- Chart.js 4.x - Interactive charts
- DataTables.js 1.13.x - Advanced table features
- Moment.js 2.29.x - Date manipulation
- SweetAlert2 11.x - Beautiful modals

---

## Application Architecture

### Directory Structure

```
web/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # FastAPI app entry point
‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # Web-specific configuration
‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py            # Dependency injection
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/                       # API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py                # Authentication endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients.py             # Client CRUD endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deadlines.py           # Deadline CRUD endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py               # User management endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics.py           # Analytics/statistics
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ export.py              # Data export endpoints
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py                # WebUser model for authentication
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas.py             # Pydantic request/response schemas
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                  # Business logic layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py        # Authentication logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client_service.py      # Client operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deadline_service.py    # Deadline operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py        # User management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics_service.py   # Analytics calculations
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ middleware/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ auth_middleware.py     # JWT validation
‚îÇ       ‚îî‚îÄ‚îÄ cors_middleware.py     # CORS configuration
‚îÇ
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ material.min.css       # MDL framework
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.css               # Custom styles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ responsive.css
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                   # External libraries
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ material.min.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chart.min.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ datatables.min.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ moment.min.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sweetalert2.min.js
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                 # Utility modules
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js             # API client
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js            # Auth utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.js         # LocalStorage wrapper
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.js      # Form validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.js      # Data formatting
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/            # Reusable components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navbar.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ table.js           # DataTable wrapper
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modal.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chart.js           # Chart.js wrapper
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/                 # Page-specific logic
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ login.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dashboard.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ clients.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ deadlines.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ users.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ img/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo.svg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ fonts/
‚îÇ       ‚îî‚îÄ‚îÄ roboto/
‚îÇ
‚îî‚îÄ‚îÄ templates/
    ‚îú‚îÄ‚îÄ base.html                  # Base template
    ‚îú‚îÄ‚îÄ login.html                 # Login page
    ‚îú‚îÄ‚îÄ dashboard.html             # Dashboard
    ‚îú‚îÄ‚îÄ clients.html               # Clients management
    ‚îú‚îÄ‚îÄ deadlines.html             # Deadlines management
    ‚îú‚îÄ‚îÄ users.html                 # Users management
    ‚îî‚îÄ‚îÄ components/
        ‚îú‚îÄ‚îÄ navbar.html
        ‚îú‚îÄ‚îÄ sidebar.html
        ‚îî‚îÄ‚îÄ modals.html
```

### Component Interaction Flow

**HTTP Request Flow:**
1. Browser ‚Üí HTTP Request ‚Üí Uvicorn Server
2. CORS Middleware ‚Üí validate origin
3. Authentication Middleware ‚Üí validate JWT token
4. FastAPI Router ‚Üí route to appropriate endpoint
5. Endpoint ‚Üí call Service layer
6. Service ‚Üí interact with Database (SQLAlchemy)
7. Service ‚Üí return data to Endpoint
8. Endpoint ‚Üí format response (Pydantic schema)
9. Response ‚Üí Browser

**Frontend Data Flow:**
1. User Action (click, form submit) ‚Üí Event Handler
2. Page JS ‚Üí call API utility
3. API utility ‚Üí HTTP request with auth token
4. Receive response ‚Üí validate/parse
5. Update DOM ‚Üí render data
6. Show feedback ‚Üí success/error notification

---

## Database Schema Extension

### New Table: web_users

User accounts for web interface authentication with role-based access control.

**Purpose:** Store web application user credentials and roles separate from Telegram contacts.

**Table Structure:**

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Unique user identifier |
| username | VARCHAR(50) | UNIQUE, NOT NULL, INDEX | Login username |
| email | VARCHAR(255) | UNIQUE, NOT NULL, INDEX | User email address |
| password_hash | VARCHAR(255) | NOT NULL | Bcrypt hashed password |
| full_name | VARCHAR(255) | NULL | User's display name |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'viewer', INDEX | Access role |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE, INDEX | Account active status |
| telegram_id | VARCHAR(50) | NULL, UNIQUE | Linked Telegram account ID |
| last_login | DATETIME | NULL | Last successful login timestamp |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Account creation date |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Last modification date |

**Indexes:**
- PRIMARY: id
- UNIQUE: username, email, telegram_id
- INDEX: role, is_active

**Role Definitions:**

| Role | Description | Typical Use Case |
|------|-------------|------------------|
| admin | Full system access | System administrator, owner |
| manager | Manage clients and deadlines | Service manager, operations team |
| viewer | Read-only access | Accountant, auditor, reporting |

**Permission Matrix:**

| Feature | Viewer | Manager | Admin |
|---------|--------|---------|-------|
| View Dashboard | ‚úÖ | ‚úÖ | ‚úÖ |
| View Clients | ‚úÖ | ‚úÖ | ‚úÖ |
| Create/Edit Clients | ‚ùå | ‚úÖ | ‚úÖ |
| Delete Clients | ‚ùå | ‚ùå | ‚úÖ |
| View Deadlines | ‚úÖ | ‚úÖ | ‚úÖ |
| Create/Edit Deadlines | ‚ùå | ‚úÖ | ‚úÖ |
| Delete Deadlines | ‚ùå | ‚úÖ | ‚úÖ |
| View Analytics | ‚úÖ | ‚úÖ | ‚úÖ |
| Export Data | ‚ùå | ‚úÖ | ‚úÖ |
| Manage Users | ‚ùå | ‚ùå | ‚úÖ |
| System Settings | ‚ùå | ‚ùå | ‚úÖ |

**Migration Script:**

Create migration file: `backend/migrations/005_add_web_users.sql`

```sql
CREATE TABLE IF NOT EXISTS web_users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    role VARCHAR(20) NOT NULL DEFAULT 'viewer',
    is_active BOOLEAN NOT NULL DEFAULT 1,
    telegram_id VARCHAR(50) UNIQUE,
    last_login DATETIME,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_web_users_username ON web_users(username);
CREATE INDEX idx_web_users_email ON web_users(email);
CREATE INDEX idx_web_users_role ON web_users(role);
CREATE INDEX idx_web_users_active ON web_users(is_active);

-- Create default admin user (password: admin123 - MUST BE CHANGED!)
INSERT INTO web_users (username, email, password_hash, full_name, role, is_active)
VALUES (
    'admin',
    'admin@kkt-system.local',
    '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5GyYdNX.Jxnae',
    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
    'admin',
    1
);
```

**SQLAlchemy Model:** (in `web/app/models/user.py`)

Define WebUser model extending Base from backend.database, following existing model patterns.

---

## API Endpoints Specification

### Authentication Endpoints

#### POST /api/auth/login

**Purpose:** Authenticate user and obtain JWT access token.

**Request Body:**
```json
{
  "username": "string (3-50 chars, required)",
  "password": "string (min 6 chars, required)"
}
```

**Response 200 OK:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@kkt-system.local",
    "full_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
    "role": "admin"
  }
}
```

**Errors:**
- 401 Unauthorized - Invalid credentials
- 403 Forbidden - Account deactivated
- 422 Validation Error - Invalid input format

**Implementation Notes:**
- Verify password using bcrypt
- Update last_login timestamp
- Generate JWT with 8-hour expiration
- Include user_id, username, role in token payload

---

#### GET /api/auth/me

**Purpose:** Get current authenticated user information.

**Headers:**
- Authorization: Bearer {token}

**Response 200 OK:**
```json
{
  "id": 1,
  "username": "admin",
  "email": "admin@kkt-system.local",
  "full_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
  "role": "admin",
  "telegram_id": null,
  "last_login": "2024-01-15T10:30:00Z",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Errors:**
- 401 Unauthorized - Invalid or expired token

---

### Client Management Endpoints

#### GET /api/clients

**Purpose:** Retrieve paginated list of clients with filtering.

**Query Parameters:**
- `page`: integer (default: 1)
- `per_page`: integer (default: 20, max: 100)
- `search`: string (search in name, INN)
- `is_active`: boolean
- `sort_by`: enum [name, inn, created_at]
- `sort_order`: enum [asc, desc]

**Response 200 OK:**
```json
{
  "items": [
    {
      "id": 1,
      "name": "–û–û–û –†–æ–º–∞—à–∫–∞",
      "inn": "7701234567",
      "contact_person": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
      "phone": "+7 (495) 123-45-67",
      "email": "info@romashka.ru",
      "is_active": true,
      "deadlines_count": 5,
      "active_deadlines_count": 3,
      "nearest_deadline": "2024-02-15",
      "created_at": "2023-06-01T00:00:00Z"
    }
  ],
  "total": 42,
  "page": 1,
  "per_page": 20,
  "pages": 3
}
```

**Required Role:** viewer (read), manager (for further actions)

---

#### GET /api/clients/{client_id}

**Purpose:** Get detailed client information including deadlines.

**Path Parameters:**
- `client_id`: integer

**Response 200 OK:**
```json
{
  "id": 1,
  "name": "–û–û–û –†–æ–º–∞—à–∫–∞",
  "inn": "7701234567",
  "contact_person": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
  "phone": "+7 (495) 123-45-67",
  "email": "info@romashka.ru",
  "address": "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10",
  "notes": "–ö–ª—é—á–µ–≤–æ–π –∫–ª–∏–µ–Ω—Ç",
  "is_active": true,
  "created_at": "2023-06-01T00:00:00Z",
  "updated_at": "2024-01-10T15:30:00Z",
  "deadlines": [
    {
      "id": 1,
      "deadline_type": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ö–ö–¢",
      "expiration_date": "2024-02-15",
      "days_remaining": 30,
      "status": "active",
      "status_color": "yellow",
      "notes": null
    }
  ],
  "contacts": [
    {
      "id": 1,
      "telegram_id": "123456789",
      "telegram_username": "ivanov_ii",
      "notifications_enabled": true
    }
  ]
}
```

**Errors:**
- 404 Not Found - Client not found

**Required Role:** viewer

---

#### POST /api/clients

**Purpose:** Create new client record.

**Request Body:**
```json
{
  "name": "string (required, max 255, unique)",
  "inn": "string (required, 10 or 12 digits, unique)",
  "contact_person": "string (optional, max 255)",
  "phone": "string (optional, max 20)",
  "email": "string (optional, valid email)",
  "address": "string (optional)",
  "notes": "string (optional)",
  "is_active": "boolean (default: true)"
}
```

**Response 201 Created:**
Returns created client object (same structure as GET /api/clients/{id})

**Errors:**
- 400 Bad Request - Duplicate name or INN
- 422 Validation Error - Invalid input

**Required Role:** manager

---

#### PUT /api/clients/{client_id}

**Purpose:** Update existing client.

**Request Body:** Same as POST (all fields optional except uniqueness constraints)

**Response 200 OK:** Updated client object

**Errors:**
- 404 Not Found
- 400 Bad Request - Duplicate
- 422 Validation Error

**Required Role:** manager

---

#### DELETE /api/clients/{client_id}

**Purpose:** Soft delete (deactivate) or permanently delete client.

**Query Parameters:**
- `permanent`: boolean (default: false)

**Response 204 No Content**

**Errors:**
- 404 Not Found
- 409 Conflict - Cannot delete client with active deadlines (if permanent=true)

**Required Role:** admin

**Implementation:**
- If permanent=false: set is_active=false
- If permanent=true: check for deadlines, then delete

---

### Deadline Management Endpoints

#### GET /api/deadlines

**Purpose:** Retrieve paginated list of deadlines with advanced filtering.

**Query Parameters:**
- `page`, `per_page` - pagination
- `client_id` - filter by client
- `deadline_type_id` - filter by type
- `status` - filter by status (active, expired, renewed)
- `status_color` - filter by urgency (green, yellow, red, expired)
- `date_from`, `date_to` - date range filter
- `days_remaining_min`, `days_remaining_max` - days filter
- `sort_by` - [expiration_date, client_name, deadline_type]
- `sort_order` - [asc, desc]

**Response 200 OK:**
```json
{
  "items": [
    {
      "id": 1,
      "client_id": 1,
      "client_name": "–û–û–û –†–æ–º–∞—à–∫–∞",
      "client_inn": "7701234567",
      "deadline_type_id": 1,
      "deadline_type_name": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ö–ö–¢",
      "expiration_date": "2024-02-15",
      "days_remaining": 30,
      "status": "active",
      "status_color": "yellow",
      "notes": null,
      "created_at": "2023-02-15T00:00:00Z",
      "updated_at": "2023-02-15T00:00:00Z"
    }
  ],
  "total": 156,
  "page": 1,
  "per_page": 20,
  "pages": 8
}
```

**Required Role:** viewer

---

#### POST /api/deadlines

**Purpose:** Create new deadline for a client.

**Request Body:**
```json
{
  "client_id": "integer (required, must exist)",
  "deadline_type_id": "integer (required, must exist)",
  "expiration_date": "string (required, ISO date, future)",
  "notes": "string (optional)",
  "status": "string (default: active)"
}
```

**Response 201 Created:** Complete deadline object

**Errors:**
- 400 Bad Request - Invalid client_id or deadline_type_id
- 422 Validation Error - Invalid date

**Required Role:** manager

---

#### PUT /api/deadlines/{deadline_id}

**Purpose:** Update existing deadline.

**Request Body:** Same as POST (all fields optional)

**Response 200 OK:** Updated deadline object

**Required Role:** manager

---

#### DELETE /api/deadlines/{deadline_id}

**Purpose:** Delete deadline record.

**Response 204 No Content**

**Errors:**
- 404 Not Found

**Required Role:** manager

---

### User Management Endpoints

#### GET /api/users

**Purpose:** List web interface users.

**Query Parameters:**
- `page`, `per_page`
- `role` - filter by role
- `is_active` - filter by status

**Response 200 OK:**
```json
{
  "items": [
    {
      "id": 1,
      "username": "admin",
      "email": "admin@kkt-system.local",
      "full_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
      "role": "admin",
      "is_active": true,
      "telegram_id": null,
      "last_login": "2024-01-15T10:30:00Z",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 5,
  "page": 1,
  "per_page": 20
}
```

**Required Role:** admin

---

#### POST /api/users

**Purpose:** Create new user account.

**Request Body:**
```json
{
  "username": "string (3-50 chars, unique)",
  "email": "string (valid email, unique)",
  "password": "string (min 8 chars, complexity required)",
  "full_name": "string (optional)",
  "role": "enum [admin, manager, viewer]",
  "telegram_id": "string (optional)",
  "is_active": "boolean (default: true)"
}
```

**Response 201 Created:** User object (without password_hash)

**Required Role:** admin

---

#### PUT /api/users/{user_id}

**Purpose:** Update user account.

**Request Body:** Same as POST (all optional, password only if changing)

**Response 200 OK:** Updated user object

**Required Role:** admin

---

#### DELETE /api/users/{user_id}

**Purpose:** Deactivate or delete user.

**Response 204 No Content**

**Errors:**
- 403 Forbidden - Cannot delete own account or last admin

**Required Role:** admin

---

### Analytics Endpoints

#### GET /api/analytics/dashboard

**Purpose:** Get comprehensive dashboard statistics.

**Response 200 OK:**
```json
{
  "clients": {
    "total": 42,
    "active": 38,
    "inactive": 4
  },
  "deadlines": {
    "total": 156,
    "active": 143,
    "expired": 13,
    "by_status": {
      "green": 95,
      "yellow": 32,
      "red": 16,
      "expired": 13
    }
  },
  "upcoming_deadlines": [
    {
      "client_name": "–û–û–û –†–æ–º–∞—à–∫–∞",
      "deadline_type": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ö–ö–¢",
      "expiration_date": "2024-02-15",
      "days_remaining": 5,
      "status_color": "red"
    }
  ],
  "deadlines_by_month": [
    {"month": "2024-01", "count": 12},
    {"month": "2024-02", "count": 18}
  ],
  "notifications": {
    "total_sent": 234,
    "success_rate": 98.5
  }
}
```

**Required Role:** viewer

---

### Export Endpoints

#### GET /api/export/clients

**Purpose:** Export clients data.

**Query Parameters:**
- `format`: enum [json, csv]
- `filter`: enum [all, active, inactive]

**Response 200 OK:** File download with appropriate Content-Type

**Required Role:** manager

---

#### GET /api/export/deadlines

**Purpose:** Export deadlines data.

**Query Parameters:**
- `format`: enum [json, csv]
- `client_id`: integer (optional)
- `date_from`, `date_to`: ISO dates

**Response 200 OK:** File download

**Required Role:** manager

---

## User Interface Design

### Design System

**Material Design Principles:**
- Clean, minimalist interface
- Consistent color scheme and typography
- Responsive grid system (mobile-first)
- Subtle animations for user feedback
- Accessibility compliance (WCAG 2.1 AA)

**Color Palette:**
- Primary: #1976D2 (Material Blue 700)
- Accent: #FF6F00 (Material Orange 900)
- Success: #4CAF50, Warning: #FFC107, Error: #F44336
- Background: #FAFAFA, Surface: #FFFFFF
- Text: #212121 (primary), #757575 (secondary)

**Typography:**
- Font: Roboto (Material Design standard)
- H1: 40px/300, H2: 32px/400, H3: 28px/400
- Body: 16px/400, Caption: 14px/400

### Page Layouts

**Common Structure:**
```
+----------------------------------+
|     Top Navigation Bar           |
|  (Logo, User Menu, Notifications)|
+--------+-------------------------+
|        |                         |
| Side   |   Main Content Area     |
| bar    |                         |
|        |   - Page Title          |
| (Nav)  |   - Breadcrumbs         |
|        |   - Action Buttons      |
|        |   - Content Cards       |
|        |   - Data Tables         |
|        |                         |
+--------+-------------------------+
```

**Responsive Breakpoints:**
- Mobile: < 768px (sidebar ‚Üí hamburger menu)
- Tablet: 768px - 1024px (narrow sidebar)
- Desktop: > 1024px (full sidebar)

### Key Pages

**1. Login Page**
- Centered card on gradient background
- Logo, username/password fields
- "Remember me" checkbox
- Form validation with inline errors

**2. Dashboard**
- Statistics cards (4 metrics)
- Doughnut chart (deadlines by status)
- Upcoming deadlines table (top 10)
- Timeline chart (12 months trend)
- Recent activity feed

**3. Clients Management**
- Search bar + filters panel
- Data table with sorting/pagination
- Actions: Add, Edit, Delete, View
- Add/Edit modal with form validation

**4. Deadlines Management**
- Quick filters (Today, Week, Month, Overdue)
- Advanced filters (client, type, status, dates)
- Calendar view toggle
- Color-coded status indicators

**5. Users Management** (Admin only)
- User list with role badges
- Add/Edit user modal
- Cannot delete own account or last admin
- Activity log per user

---

## Security & Authentication

### Authentication Flow

**JWT Token Structure:**
```json
{
  "sub": "user_id",
  "username": "admin",
  "role": "admin",
  "exp": 1705334400,
  "iat": 1705305600
}
```

**Token Lifecycle:**
- Access token: 8 hours (stored in localStorage)
- Auto-refresh 5 minutes before expiration
- Logout clears token and redirects to login

**Security Measures:**

1. **Password Security:**
   - Minimum 8 characters
   - Must contain: uppercase, lowercase, number
   - Bcrypt hashing (cost factor 12)
   - No password in responses

2. **Session Security:**
   - HTTPS only in production
   - Secure, httpOnly cookies for refresh tokens
   - CSRF protection
   - Rate limiting on login (5 attempts / 15 min)

3. **API Security:**
   - JWT validation on all protected endpoints
   - Role-based access control (RBAC)
   - Input validation (Pydantic schemas)
   - SQL injection prevention (SQLAlchemy ORM)
   - XSS prevention (output escaping)

4. **Infrastructure:**
   - CORS configuration (whitelist origins)
   - Security headers (HSTS, X-Frame-Options, CSP)
   - Rate limiting (100 req/min per user)
   - Request logging and monitoring

---

## Development Timeline (2 Weeks)

### Week 1: Core Infrastructure

**Days 1-2: Backend Foundation**
- [ ] Create web/ directory structure
- [ ] Set up FastAPI application
- [ ] Create web_users table and migration
- [ ] Implement JWT authentication
- [ ] Create auth endpoints (login, /me)
- [ ] Implement auth middleware
- [ ] Test authentication flow

**Days 3-4: API Development**
- [ ] Implement Client CRUD endpoints
- [ ] Implement Deadline CRUD endpoints
- [ ] Add pagination and filtering
- [ ] Create Pydantic schemas
- [ ] Write service layer logic
- [ ] Test all endpoints (Postman/curl)

**Day 5: Frontend Setup**
- [ ] Create HTML templates (base, login)
- [ ] Set up static file structure
- [ ] Integrate Material Design Lite
- [ ] Create API client utility (api.js)
- [ ] Implement login page + authentication
- [ ] Test login flow end-to-end

### Week 2: Feature Completion

**Days 1-2: Dashboard & Clients**
- [ ] Create dashboard page with statistics
- [ ] Implement Chart.js visualizations
- [ ] Create clients management page
- [ ] Implement DataTables for client list
- [ ] Add client CRUD modals
- [ ] Test all client operations

**Days 3-4: Deadlines & Users**
- [ ] Create deadlines management page
- [ ] Implement deadline filters and calendar view
- [ ] Add deadline CRUD operations
- [ ] Create users management page (admin)
- [ ] Implement user CRUD operations
- [ ] Test role-based permissions

**Day 5: Polish & Testing**
- [ ] Implement export functionality
- [ ] Add responsive design adjustments
- [ ] Cross-browser testing
- [ ] Performance optimization
- [ ] Security review
- [ ] Documentation update
- [ ] Deployment preparation

---

## Testing Strategy

### Backend Tests (pytest)

**Unit Tests:**
- Auth service (login, token generation, validation)
- CRUD services (clients, deadlines, users)
- Permission checks
- Data validation

**Integration Tests:**
- API endpoints (all CRUD operations)
- Authentication flow
- Database operations
- Error handling

**Target:** 80% code coverage

### Frontend Tests

**Manual Testing Checklist:**

Authentication:
- [ ] Login with valid credentials
- [ ] Login with invalid credentials
- [ ] Logout clears token
- [ ] Token expiration redirects to login
- [ ] Protected routes require authentication

Client Management:
- [ ] View client list with pagination
- [ ] Search/filter clients
- [ ] Create new client
- [ ] Edit existing client
- [ ] Delete client (admin only)
- [ ] View client details with deadlines

Deadline Management:
- [ ] View deadline list
- [ ] Filter by client, type, status, dates
- [ ] Create new deadline
- [ ] Edit deadline
- [ ] Delete deadline
- [ ] Calendar view works

User Management (Admin):
- [ ] View users list
- [ ] Create new user
- [ ] Edit user role
- [ ] Delete user (not self, not last admin)
- [ ] Password validation works

Responsive Design:
- [ ] Mobile view (< 768px)
- [ ] Tablet view (768-1024px)
- [ ] Desktop view (> 1024px)
- [ ] All features work on mobile

Browser Compatibility:
- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest)
- [ ] Edge (latest)

---

## Deployment

### Development Setup

**1. Install Dependencies:**
```bash
cd web
pip install -r requirements.txt
```

**2. Run Database Migration:**
```bash
sqlite3 ../kkt_system.db < ../backend/migrations/005_add_web_users.sql
```

**3. Configure Environment:**
```env
WEB_SECRET_KEY=your-secret-key-here
WEB_DATABASE_URL=sqlite:///../kkt_system.db
WEB_DEBUG=true
WEB_CORS_ORIGINS=http://localhost:8000
```

**4. Start Development Server:**
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**5. Access Web Interface:**
- URL: http://localhost:8000
- Default credentials: admin / admin123 (CHANGE IMMEDIATELY!)

### Production Deployment

**Server Requirements:**
- Python 3.8+
- Uvicorn + Gunicorn
- Nginx (reverse proxy)
- SSL certificate (Let's Encrypt)

**Nginx Configuration:**
```nginx
server {
    listen 443 ssl http2;
    server_name kkt.yourdomain.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static {
        alias /opt/kkt-system/web/static;
        expires 30d;
    }
}
```

**Systemd Service:**
```ini
[Unit]
Description=KKT Web Interface
After=network.target

[Service]
User=www-data
WorkingDirectory=/opt/kkt-system/web
Environment="PATH=/opt/kkt-system/venv/bin"
ExecStart=/opt/kkt-system/venv/bin/gunicorn -k uvicorn.workers.UvicornWorker -w 4 -b 127.0.0.1:8000 app.main:app
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

**Security Checklist:**
- [ ] Change default admin password
- [ ] Set strong WEB_SECRET_KEY
- [ ] Enable HTTPS only
- [ ] Configure CORS whitelist
- [ ] Set up firewall rules
- [ ] Enable rate limiting
- [ ] Configure log rotation
- [ ] Set up backup strategy

---

## Success Criteria

### Functional Requirements

- ‚úÖ User authentication with JWT tokens
- ‚úÖ Role-based access control (admin/manager/viewer)
- ‚úÖ Full CRUD for clients, deadlines, users
- ‚úÖ Dashboard with real-time statistics
- ‚úÖ Data filtering, sorting, pagination
- ‚úÖ Export functionality (JSON, CSV)
- ‚úÖ Responsive design (mobile, tablet, desktop)
- ‚úÖ Form validation with user-friendly errors

### Non-Functional Requirements

- ‚úÖ Page load time < 2 seconds
- ‚úÖ API response time < 500ms
- ‚úÖ Mobile responsive (min 375px width)
- ‚úÖ Cross-browser compatibility
- ‚úÖ 80%+ backend code coverage
- ‚úÖ WCAG 2.1 AA accessibility
- ‚úÖ Zero critical security vulnerabilities
- ‚úÖ Production-ready deployment

### User Acceptance

- ‚úÖ Admin can manage all entities via web
- ‚úÖ Manager can perform daily operations
- ‚úÖ Viewer can access reports
- ‚úÖ Interface intuitive for non-technical users
- ‚úÖ Works alongside Telegram bot (shared database)

---

## Integration with Existing System

### Database Sharing

**Single Source of Truth:**
- Web interface and Telegram bot use same SQLite database
- No synchronization needed
- Real-time data consistency
- No changes to existing tables

**Coexistence Strategy:**
- Web users in separate `web_users` table
- Telegram bot continues using `contacts` table
- Optional linking via `telegram_id` field
- Both systems can operate simultaneously

### Migration Path

**Phase 1:** Install web interface alongside bot
**Phase 2:** Create web user accounts
**Phase 3:** Train users on web interface
**Phase 4:** Gradually shift management tasks to web
**Phase 5:** Keep bot for notifications, use web for management

**No Disruption:** Telegram bot continues working without any code changes.

---

## Future Enhancements

### Phase 5.1 (Optional)

- WebSocket real-time updates
- Advanced analytics with trend predictions
- Custom report builder
- Dark mode theme
- Saved filter presets
- Keyboard shortcuts

### Phase 5.2 (Optional)

- Email notifications from web
- Calendar integration (iCal export)
- Telegram bot control panel in web
- Progressive Web App (PWA)
- Mobile native app

---

## Conclusion

This technical design provides a comprehensive roadmap for implementing a modern, responsive web interface for the KKT Service Expiration Management System. The interface will complement the existing Telegram bot, offering visual management capabilities while maintaining data consistency through a shared database.

**Key Benefits:**
- Professional web-based management interface
- Role-based access control for team collaboration
- Visual analytics and reporting
- Export capabilities for external use
- No disruption to existing Telegram bot functionality

**Estimated Effort:** 2 weeks (80 development hours)

**Next Steps:** Begin Week 1 implementation following the detailed development timeline.
