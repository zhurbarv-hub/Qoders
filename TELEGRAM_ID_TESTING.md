# Тестирование функции Telegram ID

## Что было исправлено:

### 1. Добавлено поле Telegram ID в формы
- ✅ Поле "Telegram ID" добавлено в модальные окна создания и редактирования администраторов/менеджеров
- ✅ Валидация: только цифры (pattern="[0-9]+")
- ✅ Поле необязательное, можно оставить пустым

### 2. Добавлена проверка уникальности
- ✅ При создании пользователя: проверка, что Telegram ID не занят
- ✅ При обновлении пользователя: проверка дубликатов
- ✅ Понятное сообщение об ошибке: показывает, кто уже использует этот Telegram ID

### 3. Текущее состояние базы данных
- Telegram ID **556319278** уже привязан к: **Журба Руслан** (admin)

## Как протестировать:

### Тест 1: Просмотр существующего Telegram ID
1. Откройте https://kkt-box.net/static/dashboard.html#managers
2. Обновите страницу (Ctrl+Shift+R)
3. Кликните на строку "Журба Руслан"
4. В модальном окне должно отображаться поле "Telegram ID: 556319278"

### Тест 2: Попытка использовать занятый Telegram ID (ожидается ошибка)
1. Откройте другого пользователя (менеджера)
2. Попробуйте указать Telegram ID: **556319278**
3. Нажмите "Сохранить"
4. ❌ Должна появиться ошибка: "Telegram ID 556319278 уже используется пользователем 'Журба Руслан' (admin)"

### Тест 3: Добавление нового уникального Telegram ID
1. Откройте пользователя без Telegram ID
2. Введите новый Telegram ID (например: 123456789)
3. Нажмите "Сохранить"
4. ✅ Должно сохраниться успешно

### Тест 4: Создание нового пользователя с Telegram ID
1. Нажмите "Добавить пользователя"
2. Заполните обязательные поля (логин, ФИО, email, роль)
3. Укажите Telegram ID (новый, уникальный)
4. Нажмите "Создать"
5. ✅ Пользователь должен создаться

### Тест 5: Очистка Telegram ID
1. Откройте пользователя с Telegram ID
2. Очистите поле Telegram ID (удалите все цифры)
3. Нажмите "Сохранить"
4. ✅ Telegram ID должен удалиться из базы данных

## Развёрнутые файлы:

1. `/home/kktapp/kkt-system/web/app/static/js/managers.js` (v=5.2telegram)
2. `/home/kktapp/kkt-system/web/app/static/dashboard.html`
3. `/home/kktapp/kkt-system/web/app/api/users.py`

## Статус сервисов:

- ✅ kkt-web.service: active (running), PID 12222
- ✅ Последний перезапуск: 20 Dec 17:27:56

## Примечания:

- Telegram ID должен содержать только цифры
- Каждый Telegram ID может быть привязан только к одному пользователю
- Поле необязательное - можно оставить пустым
